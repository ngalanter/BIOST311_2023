---
title: "Survival Analysis II"
subtitle: "BIOST 311, Discussion Section Week 10"
author: "Nina Galanter"
date: \today
output: 
  pdf_document:
    toc: false
header-includes:
  - \usepackage{color}
  - \usepackage{fvextra}
  - \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
library(formatR)

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(error = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(results = "hide")
```

# Introduction

In this discussion section, we'll walk through a survival analysis problem using cox regression. We will use the `veteran`  dataset. This is a randomized trial of treatments for lung cancer within the Veteran's Administration medical system. The event of interest is deaht. The `time` variable is the follow-up variable and `status` is the event variable.


```{r}
library(tidyverse)
library(readr)
library(survival)
library(survminer)

```

# Cox Proportional Hazards Regression

1. Calculate the proportion of subjects that were censored.

2. Use a cox regression model and interpret the results to answer the scientific question of what is the association between treatment and survival. 

# Plotting Survival Curves

2. The `ggsurvplot` in the `survminer` package provides an easier way to plot Kaplan-Meier estimates (though sometimes there seem to be bugs). Use this package to plot the Kaplan-Meier estimates of survival by cell type. Incomplete code is below.

```{r}

#fit <- survfit( Surv( VAR , VAR ) ~ VAR , data = DATA)
#ggsurvplot(fit, conf.int = T) + labs(x = "Time (Days)")
```


4. While it is not necessary to estimate the baseline hazard in order to estimate parameters from a Cox model, it is possible to estimate this hazard and thus absolute (not just relative) survival. Create a Cox model that predicts survival based on cell type (as a factor) and use the `ggsurvplot` function to plot the Cox model estimates of survival based on cell type. 

```{r}
#mod <- 
#newdata <- data.frame(celltype=CELLTYPES)
#fit <- survfit(mod, newdata = newdata, data = DATA)
#ggsurvplot(fit, conf.int = T)+ labs(x = "Time (Days)")
```

5. Compare the two plots. What do you notice?

6. Bonus: We can use the `anova` function with Cox models to test associations between categorical variables and survival. Using `anova`, is there a significant association between survival and cell type, at the 5% significance level?


