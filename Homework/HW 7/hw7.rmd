---
title: "Homework 7"
subtitle: "BIOST 311"
author: "Nina Galanter"
date: \today
output: 
  pdf_document:
    toc: false
header-includes:
  - \usepackage{color}
  - \usepackage{fvextra}
  - \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
editor_options: 
  chunk_output_type: console
---

  
```{r setup, include=FALSE}
library(formatR)

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(error = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(results = "hide")
```


## Instructions

This assignment should be submitted on Canvas as a .pdf by 11:59pm on **Thursday, May 25th**. You are welcome to work together on the homework; however, final solutions should be written up individually. 

Unedited software output in the body of your assignment is not acceptable. Please round numerical values to 2--3 significant digits, and include your R code (if applicable) in the same document. See the "How to Write a Proper Homework" document on Canvas for additional guidelines.  

Each homework assignment is worth 20 points total. Problems are graded for correctness, according to the number of points given in the problem statement. Homeworks will be marked complete if you get at least 16/20 points, otherwise the homework is incomplete pending a possible revision. 


```{r preliminaries}
library(readr)
library(tidyverse)
library(ggplot2)
library(knitr)
library(survival)
library(survminer)
```

## 1. Prediction with logistic regression

a. Using the HIV data, build a model using distance, age, and incentive amount to predict whether someone will choose to go get a result. Evaluate its performance by creating an ROC curve and calculating the area under the curve (AUC). Be sure to evaluate your model on out-of-sample testing data! (5 points)

## 2. Characteristics of survival data

Suppose I am studying people with severe bone fractures, and I am interested in knowing whether or not the time it takes for the fracture to heal varies depending on whether the individual with the fracture had surgery. The more severe a fracture is, the more likely that surgery will be recommended. We hypothesize that individuals who had surgery will have longer healing times than those who did not have surgery, given that more severe fractures take longer to heal. We enroll people in our study at the time they have a severe bone fracture, and follow them over time to record when their fracture healed completely, measured at a follow-up clinic appointment. We lose a few people in our study to follow-up, and we end our study after 20 weeks, where a few individuals are subject to administrative censoring.

For scenarios 1a through 1d, determine whether or not the independent censoring assumption holds, and justify your answer.

a. Participants exit the study because their health has worsened to the point where they cannot come to the clinic for a follow-up appointment. (2 points)


b. Participants exit the study because they were referred to a doctor at a different clinic who specializes in treating bone fractures. (2 points)

c. Participants exit the study because they forget to return for a follow-up appointment. (2 points)

## 3. Kaplan-Meier & the log rank test

a. Load the `mayo` dataset (0 points)

b. Plot a Kaplan-Meier survival curve for all individuals in the dataset (that is, just a single curve, no stratification by another variable). Report the median survival time for individuals in your dataset. (2 points)

d. Create a new, binary variable called `advanced_stage` that is either 0 if `stage` is 1 or 2, or is 1 if `stage` is 3 or 4. Here, we consider `advanced_stage` equal to 0 to be a non-advanced stage of disease, and `advanced_stage` equal to 1 to be an advanced stage of disease. Plot Kaplan-Meier survival curves for all individuals in the dataset, stratified by `advanced_stage`. Include a legend in your plot. Based on your plot, what do you notice about the relationship between time to death and advanced stage of disease? (3 points)

e. Conduct a log-rank test for a survival difference by advanced stage of disease (a binary variable). Your answer must include a statement of null and alternative hypotheses, as well as a conclusion based on a p-value. (2 points)

## 4. Cox proportional hazards regression


a. Perform a Cox proportional hazards regression analysis to assess whether `age` is associated with survival time. Interpret the output of your model; don't just give numerical output. Be sure to include a statistic quantifying the association with appropriate uncertainty quantification, as well as hypothesis tests. Be sure to state the null and alternative hypotheses. (2 points)


